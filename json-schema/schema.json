{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/DecentralizedGeo/dgeo/refs/heads/main/json-schema/schema.json",
  "title": "Decentralized Geospatial Extension",
  "description": "Associates STAC Items and Collections with decentralized web resources. This extension enables queryable CID-based discovery while providing technical DAG metadata at the asset level.",
  "type": "object",
  "required": ["stac_extensions"],
  "properties": {
    "stac_extensions": {
      "type": "array",
      "contains": {
        "const": "https://raw.githubusercontent.com/DecentralizedGeo/dgeo/refs/heads/main/json-schema/schema.json"
      }
    }
  },
  "oneOf": [
    {
      "title": "STAC Item",
      "type": "object",
      "required": ["type", "properties", "assets"],
      "properties": {
        "type": {
          "const": "Feature"
        },
        "properties": {
          "$ref": "#/definitions/dgeo_fields"
        },
        "assets": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/dgeo_asset_fields"
          }
        }
      }
    },
    {
      "title": "STAC Collection",
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "const": "Collection"
        },
        "assets": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/dgeo_asset_fields"
          }
        }
      },
      "allOf": [
        {
          "$ref": "#/definitions/dgeo_fields"
        }
      ]
    },
    {
      "title": "STAC Catalog",
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "const": "Catalog"
        }
      }
    }
  ],
  "definitions": {
    "dgeo_fields": {
      "type": "object",
      "required": ["dgeo:cids"],
      "properties": {
        "dgeo:cids": {
          "type": "array",
          "description": "REQUIRED. Array of IPFS Content Identifiers (CIDs) associated with this Item or Collection. Each CID MUST be immutable; mutable pointers such as IPNS MUST NOT be included. This field is queryable via pgstac and STAC API CQL2 filters.",
          "items": {
            "type": "string",
            "pattern": "^(Qm[1-9A-HJ-NP-Za-km-z]{44}|b[a-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,})$"
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "dgeo:piece_cids": {
          "type": "array",
          "description": "OPTIONAL. Array of Filecoin Piece CIDs (commP) used for storage verification and proof-of-replication workflows. This field is queryable via pgstac and STAC API CQL2 filters.",
          "items": {
            "type": "string",
            "pattern": "^baga6ea[a-z2-7]{52,}$"
          },
          "uniqueItems": true
        }
      }
    },
    "dgeo_asset_fields": {
      "type": "object",
      "properties": {
        "dgeo:cid": {
          "type": "string",
          "description": "OPTIONAL. The IPFS CID that this asset represents. When present, this CID MUST also appear in the Item's dgeo:cids array. This field enables programmatic correlation between queryable CIDs and specific assets, particularly when hrefs use HTTP gateway URLs that don't directly expose the CID.",
          "pattern": "^(Qm[1-9A-HJ-NP-Za-km-z]{44}|b[a-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,})$"
        },
        "dgeo:cid_profile": {
          "type": "object",
          "description": "OPTIONAL. Technical details about how the CID's DAG was generated (chunking, hashing, layout, sharding, etc.). This metadata enables reproducible DAG reconstruction and verification workflows.",
          "additionalProperties": true,
          "properties": {
            "cid_version": {
              "type": "integer",
              "enum": [0, 1],
              "description": "CID version (0 or 1). RECOMMENDED when cid_profile is present."
            },
            "multibase_encoding": {
              "type": "string",
              "description": "Multibase encoding of the CID string (e.g., base32, base58btc). OPTIONAL."
            },
            "hash_function": {
              "type": "string",
              "description": "RECOMMENDED. Multihash function used when constructing the CID (e.g., sha2-256, blake3)."
            },
            "chunk_algorithm": {
              "type": "string",
              "description": "RECOMMENDED. Algorithm used to split data (e.g., fixed, balanced, rabin)."
            },
            "chunk_size": {
              "type": "integer",
              "description": "Target size of chunks in bytes. OPTIONAL."
            },
            "dag_width": {
              "type": "integer",
              "description": "Maximum number of links per block. OPTIONAL."
            },
            "dag_layout": {
              "type": "string",
              "description": "RECOMMENDED. Layout algorithm (e.g., balanced, trickle, hamt-directory)."
            },
            "directory_wrapping": {
              "type": "boolean",
              "description": "OPTIONAL. Wrap single files in directories to retain filename metadata."
            },
            "hamt_directory_fanout": {
              "type": "integer",
              "description": "OPTIONAL. Fanout for HAMT-sharded directories (default bitwidth is 8 == 256 leaves)."
            },
            "hamt_directory_threshold": {
              "type": "integer",
              "description": "OPTIONAL. Threshold size at which a regular directory transitions to HAMT-sharded representation."
            },
            "leaf_envelope": {
              "type": "string",
              "description": "OPTIONAL. How leaf nodes are represented (raw or dag-pb), enabling validation of expected leaf node types."
            }
          }
        }
      }
    }
  }
}
